pipeline {
  agent any
  stages {
    stage('Run playbook') {
      steps{
        withCredentials([usernamePassword(credentialsId: 'nikitasp1992_dockerhub', usernameVariable: 'DOCKERHUB_USER', passwordVariable: 'DOCKERHUB_PASSWORD')]) {
          ansiblePlaybook(
            playbook: 'ansible/prepare.yml',
            inventory: "${NODE_IP}",
            credentialsId: 'jenkins_main',
            limit: 'node',
            extraVars: [
              DOCKERHUB_USER: "${DOCKERHUB_USER}",
              DOCKERHUB_PASSWORD: "${DOCKERHUB_PASSWORD}",
              BUILD_NUMBER: "${BUILD_NUMBER}"
            ]
          )
        }
      }
    }
  }
}